(self.webpackChunkassignment_ui=self.webpackChunkassignment_ui||[]).push([[985],{9985:function(t,e,o){"use strict";o.r(e),o.d(e,{VendorManagementModule:function(){return P}});var r=o(9153),a=o(4577),i=o(9582),n=o(3606),s=o(8370),p=o(3534),l=o(2870),d=o(6274);function c(t,e){if(1&t&&(n.TgZ(0,"div",11),n.TgZ(1,"p",8),n._uU(2),n.qZA(),n.qZA()),2&t){const t=n.oxw(2);n.xp6(2),n.Oqu(t.vendor_detail.workflow_status)}}function u(t,e){if(1&t&&(n.TgZ(0,"div",1),n.TgZ(1,"div",2),n.TgZ(2,"div",3),n.TgZ(3,"div",4),n.TgZ(4,"div",5),n._uU(5),n.qZA(),n.qZA(),n.qZA(),n.TgZ(6,"div",6),n.TgZ(7,"div",7),n.TgZ(8,"p",8),n._uU(9,"Vendor Information"),n.qZA(),n.TgZ(10,"a",9),n._UZ(11,"i",10),n._uU(12," Manage Workflow"),n.qZA(),n.qZA(),n.TgZ(13,"div",11),n.TgZ(14,"ul",12),n.TgZ(15,"li"),n.TgZ(16,"p",13),n._uU(17,"Vendor"),n.qZA(),n.TgZ(18,"p",14),n._uU(19),n.qZA(),n.qZA(),n.TgZ(20,"li"),n.TgZ(21,"p",13),n._uU(22,"Created On"),n.qZA(),n.TgZ(23,"p",14),n._uU(24),n.ALo(25,"date"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.YNc(26,c,3,1,"div",15),n.qZA(),n.qZA(),n.qZA()),2&t){const t=n.oxw();n.xp6(5),n.Oqu(t.vendor_tag),n.xp6(5),n.MGl("routerLink","/portal/application/vendors/workflow-detail/",t.vendor_detail._id,""),n.xp6(9),n.Oqu(t.vendor_detail.vendor_name),n.xp6(5),n.Oqu(n.xi3(25,5,t.vendor_detail.created_at,"medium")),n.xp6(2),n.Q6J("ngIf",t.vendor_detail.workflow_status)}}let _=(()=>{class t{constructor(){this.vendor_tag="",this._reInitialize=new i.xQ}ngOnInit(){this._reInitialize.subscribe(t=>{if(t){this.vendor_detail=t;const e=t.vendor_name.split(" ");this.vendor_tag=e.length>1?`${e[0].charAt(0)}${e[1].charAt(0)}`:`${e[0].charAt(0)}`}})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-vendor-detail"]],inputs:{_reInitialize:"_reInitialize"},decls:1,vars:1,consts:[["class","data-container",4,"ngIf"],[1,"data-container"],[1,"row"],[1,"col-md-3","col-sm-12","text-center","col-no-padding"],[1,"display-picture"],[1,"rounded-circle","avatar-xl","default-dp"],[1,"col-md-9","col-sm-12","col-no-padding"],[1,"section-wrapper","mb-4"],[1,"section-heading"],[1,"btn-datatable-2",3,"routerLink"],[1,"mdi","mdi-pencil","mdi-18px"],[1,"col-sm-12","mb-4","col-no-padding"],[1,"meta-data-list"],[1,"label"],[1,"main-menu"],["class","col-sm-12 mb-4 col-no-padding",4,"ngIf"]],template:function(t,e){1&t&&n.YNc(0,u,27,8,"div",0),2&t&&n.Q6J("ngIf",e.vendor_detail)},directives:[d.O5,a.yS],pipes:[d.uU],styles:[""]}),t})();function g(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"tr",10),n.NdJ("click",function(){const e=n.CHM(t).$implicit;return n.oxw().showDetails(e)}),n.TgZ(1,"td"),n._uU(2),n.qZA(),n.TgZ(3,"td"),n._uU(4),n.qZA(),n.TgZ(5,"td"),n._uU(6),n.ALo(7,"date"),n.qZA(),n.qZA()}if(2&t){const t=e.$implicit,o=e.index;n.xp6(2),n.Oqu(o+1),n.xp6(2),n.Oqu(t.vendor_name),n.xp6(2),n.Oqu(n.xi3(7,3,t.created_at,"medium"))}}let v=(()=>{class t{constructor(t){this._vendorProvider=t,this.reInitialize=new i.xQ,this.headerArray=[{label:"Sl No.",additional_class:"sl_no"},{label:"Vendor",additional_class:""},{label:"Created On",additional_class:""}]}ngOnInit(){}handleEmitterData(t){this.vendorsList=t,this.showDetails(t[0])}showDetails(t){this.reInitialize.next(t)}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.mq))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-vendor"]],decls:14,vars:5,consts:[["header","",1,"card-header"],["routerLink","/portal/application/vendors/create-vendor",1,"btn","btn-with-icon"],[1,"mdi","mdi-plus","mr-2"],["body","",1,"card-body"],[1,"row"],[1,"col-md-4","col-sm-12","col-no-padding"],[3,"_id","_header","_serviceObject","_reocords"],["ngFor","",3,"ngForOf"],[1,"col-md-8","col-sm-12","col-no-padding","col-divider"],[3,"_reInitialize"],[3,"click"]],template:function(t,e){1&t&&(n.TgZ(0,"app-ui-card"),n.TgZ(1,"div",0),n.TgZ(2,"h3"),n._uU(3,"Vendors"),n.qZA(),n.TgZ(4,"a",1),n._UZ(5,"i",2),n._uU(6," Create Vendor"),n.qZA(),n.qZA(),n.TgZ(7,"div",3),n.TgZ(8,"div",4),n.TgZ(9,"div",5),n.TgZ(10,"app-ui-datatable",6),n.NdJ("_reocords",function(t){return e.handleEmitterData(t)}),n.YNc(11,g,8,6,"ng-template",7),n.qZA(),n.qZA(),n.TgZ(12,"div",8),n._UZ(13,"app-vendor-detail",9),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(10),n.Q6J("_id","vendors-table")("_header",e.headerArray)("_serviceObject",e._vendorProvider),n.xp6(1),n.Q6J("ngForOf",e.vendorsList),n.xp6(2),n.Q6J("_reInitialize",e.reInitialize.asObservable()))},directives:[p.A,a.yS,l.n,d.sg,_],pipes:[d.uU],styles:[""]}),t})();var Z=o(9409);let f=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-vendor-management"]],decls:2,vars:0,template:function(t,e){1&t&&(n.TgZ(0,"app-ui-wrapper"),n._UZ(1,"router-outlet"),n.qZA())},directives:[Z.A,a.lC],styles:[""]}),t})();var h=o(4988);function m(t,e){if(1&t&&(n.TgZ(0,"th",6),n._uU(1),n.qZA()),2&t){const t=e.$implicit;n.Q6J("ngClass",t.additional_class),n.xp6(1),n.Oqu(t.label)}}function A(t,e){if(1&t&&(n.ynx(0),n.TgZ(1,"thead"),n.TgZ(2,"tr"),n.YNc(3,m,2,2,"ng-template",5),n.qZA(),n.qZA(),n.BQk()),2&t){const t=n.oxw();n.xp6(3),n.Q6J("ngForOf",t.headerArray)}}function q(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"tr"),n.TgZ(1,"td",7),n.TgZ(2,"div",8),n.TgZ(3,"input",9),n.NdJ("click",function(e){return n.CHM(t),n.oxw().selectRow(e)}),n.qZA(),n._UZ(4,"label",10),n.qZA(),n.qZA(),n.TgZ(5,"td"),n._uU(6),n.qZA(),n.TgZ(7,"td"),n._uU(8),n.ALo(9,"titlecase"),n.qZA(),n.qZA()}if(2&t){const t=e.$implicit,o=n.oxw();n.xp6(3),n.hYB("id","assign-",o._title,"-approvers-",t._id,""),n.s9C("value",t._id),n.xp6(1),n.hYB("for","assign-",o._title,"-approvers-",t._id,""),n.xp6(2),n.Oqu(t.full_name),n.xp6(2),n.Oqu(n.lcZ(9,7,t.role))}}let w=(()=>{class t{constructor(t){this._userProvider=t,this.assignData=[],this.totalRecords=0,this._contextLabel="",this.contectText="user selected",this._datatableContainer="group-options col-no-padding",this._title="",this._approversArray=new n.vpe,this.headerArray=[{label:"",additional_class:"select-row"},{label:"Full Name",additional_class:""},{label:"Role",additional_class:""}]}ngAfterViewInit(){this._userProvider.listRequest().subscribe(t=>{t.error?(this.dataList=!1,this.totalRecords=0,this.contectText="record found"):(this.dataList=t.data,this.totalRecords=t.data.length,this.contectText=this.totalRecords>1?"records found":"record found")})}selectRow(t){t.target.checked?this.assignData.push(t.target.value):this.assignData.splice(this.assignData.indexOf(t.target.value),0),this._approversArray.emit(this.assignData.join(","))}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.fz))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-ui-data-selection"]],inputs:{_title:"_title"},outputs:{_approversArray:"_approversArray"},decls:8,vars:4,consts:[[1,"group-title"],[1,"section-heading"],["data-simplebar","",3,"ngClass"],[1,"table","datatable-grid"],[4,"ngIf"],["ngFor","",3,"ngForOf"],["scope","col",3,"ngClass"],[1,"select-row"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","value","click"],[1,"custom-control-label",3,"for"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"label",1),n._uU(2),n.qZA(),n.qZA(),n.TgZ(3,"div",2),n.TgZ(4,"table",3),n.YNc(5,A,4,1,"ng-container",4),n.TgZ(6,"tbody"),n.YNc(7,q,10,9,"ng-template",5),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(2),n.hij("Assign ",e._title," Approvers"),n.xp6(1),n.Q6J("ngClass",e._datatableContainer),n.xp6(2),n.Q6J("ngIf",e.headerArray.length>0),n.xp6(2),n.Q6J("ngForOf",e.dataList))},directives:[d.mk,d.O5,d.sg],pipes:[d.rS],styles:[""]}),t})(),T=(()=>{class t{constructor(t,e,o){this._vendorProvider=t,this._router=e,this._elementRef=o,this.formGroup=new h.cw({vendor_name:new h.NI(""),sequential_approvers:new h.NI(""),round_robin_approvers:new h.NI(""),any_one_approvers:new h.NI("")})}ngAfterViewInit(){}validateForm(){$("#vendor-form").parsley().validate({group:"fieldset-0"})&&this._vendorProvider.createVendor(this.formGroup.value).subscribe(t=>{t.error||this._router.navigate(["/portal/application/vendors"])})}handleEmitter(t,e){const o=document.createEvent("Event");o.initEvent("input",!0,!0),this.formGroup.patchValue({[e]:t}),this._elementRef.nativeElement.querySelector(`#${e}`).dispatchEvent(o)}cancelForm(){$("#user-form").parsley().reset(),this.formGroup.reset()}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.mq),n.Y36(a.F0),n.Y36(n.SBq))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-create-vendor"]],decls:31,vars:4,consts:[["header","",1,"card-header"],["body","",1,"card-body"],["id","vendor-form","autocomplete","off",3,"formGroup"],[1,"row"],[1,"col-md-9","col-sm-12","form-container"],[1,"section-wrapper","mb-6"],[1,"section-heading"],[1,"form-row","mb-4"],[1,"form-group","col-md-4"],["for","vendor_name",1,"label","required"],["type","text","id","vendor_name","formControlName","vendor_name","placeholder","Enter Vendor Name","data-parsley-required","true","data-parsley-group","fieldset-0",1,"form-control"],[1,"form-row","mb-8"],[1,"form-group","sequential_approvers","col-md-4"],[3,"_title","_approversArray"],["type","text","id","sequential_approvers","formControlName","sequential_approvers","data-parsley-required","true","data-parsley-group","fieldset-0","data-parsley-class-handler",".sequential_approvers",2,"display","none"],[1,"form-group","round_robin_approvers","col-md-4"],["type","text","id","round_robin_approvers","formControlName","round_robin_approvers","data-parsley-required","true","data-parsley-group","fieldset-0","data-parsley-class-handler",".round_robin_approvers",2,"display","none"],[1,"form-group","any_one_approvers","col-md-4"],["type","text","id","any_one_approvers","formControlName","any_one_approvers","data-parsley-required","true","data-parsley-group","fieldset-0","data-parsley-class-handler",".any_one_approvers",2,"display","none"],[1,"text-right"],["type","button",1,"btn","btn-primary","mr-5px",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(t,e){1&t&&(n.TgZ(0,"app-ui-card"),n.TgZ(1,"div",0),n.TgZ(2,"h3"),n._uU(3,"Create New Vendor"),n.qZA(),n.qZA(),n.TgZ(4,"div",1),n.TgZ(5,"form",2),n.TgZ(6,"div",3),n.TgZ(7,"div",4),n.TgZ(8,"div",5),n.TgZ(9,"p",6),n._uU(10,"Vendor Information"),n.qZA(),n.qZA(),n.TgZ(11,"div",7),n.TgZ(12,"div",8),n.TgZ(13,"label",9),n._uU(14,"Vendor Name"),n.qZA(),n._UZ(15,"input",10),n.qZA(),n.qZA(),n.TgZ(16,"div",11),n.TgZ(17,"div",12),n.TgZ(18,"app-ui-data-selection",13),n.NdJ("_approversArray",function(t){return e.handleEmitter(t,"sequential_approvers")}),n.qZA(),n._UZ(19,"input",14),n.qZA(),n.TgZ(20,"div",15),n.TgZ(21,"app-ui-data-selection",13),n.NdJ("_approversArray",function(t){return e.handleEmitter(t,"round_robin_approvers")}),n.qZA(),n._UZ(22,"input",16),n.qZA(),n.TgZ(23,"div",17),n.TgZ(24,"app-ui-data-selection",13),n.NdJ("_approversArray",function(t){return e.handleEmitter(t,"any_one_approvers")}),n.qZA(),n._UZ(25,"input",18),n.qZA(),n.qZA(),n.TgZ(26,"div",19),n.TgZ(27,"button",20),n.NdJ("click",function(){return e.validateForm()}),n._uU(28,"Create Vendor"),n.qZA(),n.TgZ(29,"button",21),n.NdJ("click",function(){return e.cancelForm()}),n._uU(30,"Cancel"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(5),n.Q6J("formGroup",e.formGroup),n.xp6(13),n.Q6J("_title","Sequential"),n.xp6(3),n.Q6J("_title","Round Robin"),n.xp6(3),n.Q6J("_title","Any One"))},directives:[p.A,h._Y,h.JL,h.sg,h.Fj,h.JJ,h.u,w],styles:[""]}),t})();function y(t,e){if(1&t&&(n.TgZ(0,"h3"),n._uU(1),n.qZA()),2&t){const t=n.oxw();n.xp6(1),n.hij("Vendor #",t._vendorData._id,"")}}function x(t,e){if(1&t&&(n.TgZ(0,"div",17),n.TgZ(1,"p",19),n._uU(2),n.qZA(),n.qZA()),2&t){const t=e.$implicit;n.xp6(2),n.Oqu(t.full_name)}}function b(t,e){if(1&t&&(n.TgZ(0,"div",17),n.TgZ(1,"p",19),n._uU(2),n.qZA(),n.qZA()),2&t){const t=e.$implicit;n.xp6(2),n.Oqu(t.full_name)}}function k(t,e){if(1&t&&(n.TgZ(0,"div",17),n.TgZ(1,"p",19),n._uU(2),n.qZA(),n.qZA()),2&t){const t=e.$implicit;n.xp6(2),n.Oqu(t.full_name)}}function U(t,e){if(1&t&&(n.TgZ(0,"div",14),n.TgZ(1,"div",15),n.TgZ(2,"div",8),n.TgZ(3,"p",16),n._uU(4),n.qZA(),n.TgZ(5,"div",17),n.TgZ(6,"p",18),n._uU(7,"Created On"),n.qZA(),n.TgZ(8,"p",19),n._uU(9),n.ALo(10,"date"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(11,"div",15),n.TgZ(12,"div",8),n.TgZ(13,"p",16),n._uU(14,"Sequential Approvers"),n.qZA(),n.YNc(15,x,3,1,"ng-template",20),n.qZA(),n.qZA(),n.TgZ(16,"div",15),n.TgZ(17,"div",8),n.TgZ(18,"p",16),n._uU(19,"Round-robin Approvers"),n.qZA(),n.YNc(20,b,3,1,"ng-template",20),n.qZA(),n.qZA(),n.TgZ(21,"div",15),n.TgZ(22,"div",8),n.TgZ(23,"p",16),n._uU(24,"Any one Approvers"),n.qZA(),n.YNc(25,k,3,1,"ng-template",20),n.qZA(),n.qZA(),n.qZA()),2&t){const t=n.oxw();n.xp6(4),n.Oqu(t._vendorData.vendor_name),n.xp6(5),n.Oqu(n.xi3(10,5,t._vendorData.created_at,"medium")),n.xp6(6),n.Q6J("ngForOf",t._vendorData.sequential_approvers),n.xp6(5),n.Q6J("ngForOf",t._vendorData.round_robin_approvers),n.xp6(5),n.Q6J("ngForOf",t._vendorData.any_one_approvers)}}function O(t,e){if(1&t&&(n.TgZ(0,"option",27),n._uU(1),n.qZA()),2&t){const t=e.$implicit;n.Q6J("value",t),n.xp6(1),n.Oqu(t)}}function J(t,e){if(1&t){const t=n.EpF();n.TgZ(0,"td"),n.TgZ(1,"select",25),n.NdJ("change",function(e){n.CHM(t);const o=n.oxw(2).$implicit;return n.oxw(3).updateLog(e,o.type)}),n.YNc(2,O,2,2,"option",26),n.qZA(),n.qZA()}if(2&t){const t=n.oxw(5);n.xp6(2),n.Q6J("ngForOf",t._actions)}}function N(t,e){if(1&t&&(n.TgZ(0,"td"),n._uU(1),n.qZA()),2&t){const t=n.oxw().$implicit;n.xp6(1),n.Oqu(t.approval_action)}}function I(t,e){if(1&t&&(n.TgZ(0,"td"),n._uU(1),n.qZA()),2&t){const t=n.oxw().$implicit;n.xp6(1),n.Oqu(t.approval_action)}}function L(t,e){if(1&t&&(n.TgZ(0,"td"),n._uU(1),n.qZA()),2&t){const t=n.oxw().$implicit;n.xp6(1),n.Oqu(t.approval_action)}}function Y(t,e){if(1&t&&(n.TgZ(0,"td"),n._uU(1),n.qZA()),2&t){const t=n.oxw().$implicit;n.xp6(1),n.Oqu(t.approval_action)}}function Q(t,e){if(1&t&&(n.TgZ(0,"tr"),n.TgZ(1,"td"),n._uU(2),n.qZA(),n.YNc(3,J,3,1,"ng-template",21),n.YNc(4,N,2,1,"ng-template",21),n.YNc(5,I,2,1,"ng-template",21),n.YNc(6,L,2,1,"ng-template",21),n.YNc(7,Y,2,1,"ng-template",21),n.TgZ(8,"td"),n._uU(9),n.qZA(),n.qZA()),2&t){const t=e.$implicit,o=n.oxw().$implicit,r=n.oxw(3);n.xp6(2),n.Oqu(t.user),n.xp6(1),n.Q6J("ngIf","--"===t.approval_action&&r._currUser===t._id&&t.access),n.xp6(1),n.Q6J("ngIf","--"===t.approval_action&&r._currUser===t._id&&!t.access&&"sequential"===o.type),n.xp6(1),n.Q6J("ngIf","--"!==t.approval_action&&r._currUser===t._id&&"any-one"!==o.type),n.xp6(1),n.Q6J("ngIf",t.approval_action&&r._currUser===t._id&&"any-one"===o.type&&!t.access),n.xp6(1),n.Q6J("ngIf",r._currUser!==t._id),n.xp6(2),n.Oqu(t.workflow_status)}}function R(t,e){if(1&t&&(n.TgZ(0,"p",10),n._uU(1),n.qZA(),n.TgZ(2,"table",22),n.TgZ(3,"thead",23),n.TgZ(4,"tr"),n.TgZ(5,"th",24),n._uU(6,"Users"),n.qZA(),n.TgZ(7,"th",24),n._uU(8,"Approval Action"),n.qZA(),n.TgZ(9,"th",24),n._uU(10,"Workflow Status"),n.qZA(),n.qZA(),n.qZA(),n.TgZ(11,"tbody"),n.YNc(12,Q,10,7,"ng-template",20),n.qZA(),n.qZA()),2&t){const t=e.$implicit,o=e.index;n.xp6(1),n.AsE("Level ",o+1," (",t.type_of_approval,")"),n.xp6(11),n.Q6J("ngForOf",t.approvers)}}function C(t,e){if(1&t&&n.YNc(0,R,13,3,"ng-template",20),2&t){const t=n.oxw(2);n.Q6J("ngForOf",t.statusLog)}}function F(t,e){if(1&t&&(n.TgZ(0,"p",10),n._uU(1),n.qZA()),2&t){const t=n.oxw(2);n.xp6(1),n.Oqu(t._finalResult)}}function D(t,e){if(1&t&&(n.TgZ(0,"div",8),n.YNc(1,C,1,1,"ng-template",21),n.YNc(2,F,2,1,"ng-template",21),n.qZA()),2&t){const t=n.oxw();n.xp6(1),n.Q6J("ngIf",t.statusLog.length>0),n.xp6(1),n.Q6J("ngIf",t._finalResult)}}const V=[{path:"",component:f,children:[{path:"",component:v,data:{title:"Vendors"}},{path:"workflow-detail/:id",component:(()=>{class t{constructor(t,e,o,r,a){this._alert=t,this._auth=e,this._vendorProvider=o,this._activatedRoute=r,this._workflowProvider=a,this._level=1,this._currUser="",this._showWorkflow=!1,this._actions=["--","Approve","Reject","Reject & Remove from workflow"],this.statusLog=[],this.vendor_id=this._activatedRoute.snapshot.paramMap.get("id"),this._currUser=this._auth.getIdentity(),this.vendor_id&&this._vendorProvider.getVendor(this.vendor_id).subscribe(t=>{t.error||(this._vendorData=t.data,this.fetchWorkflow())})}ngOnInit(){}fetchWorkflow(){let t=!0;this._workflowProvider.getWorklog(this.vendor_id).subscribe(e=>{if(!e.error){let o={type_of_approval:"Sequential Approvals",type:"sequential",approvers:[]};if(this.statusLog=[],this._vendorData.sequential_approvers.forEach(r=>{let a={_id:r._id,user:r.full_name,approval_action:"--",workflow_status:"--",access:t};if(this._workflowData=e.data,e.data.length>0){var i=this.verifyApproverAction("sequential",r._id);i.length>0&&(t=!0,a.access=t,a.approval_action=i[0].approval_action,a.workflow_status=i[0].workflow_status)}else t=!1;o.approvers.push(a)}),this.statusLog.push(o),this._showWorkflow=!0,e.data.length>0){let t=this.statusLog[0].approvers[this.statusLog[0].approvers.length-1];this.prepareLog(t.approval_action,t.workflow_status)}}})}prepareLog(t,e){let o={type_of_approval:"",type:"",approvers:[]};if("--"!==t){if("Approve"===t)o.type_of_approval="Round-robin Approvals",o.type="round-robin",this._vendorData.round_robin_approvers.forEach(t=>{let r={_id:t._id,user:t.full_name,approval_action:"--",workflow_status:e,access:!0};if(this._workflowData.length>0){var a=this.verifyApproverAction("round-robin",t._id);a.length>0&&(r.approval_action=a[0].approval_action,r.workflow_status=a[0].workflow_status)}o.approvers.push(r)});else{let t=!0;o.type_of_approval="Any One Approvals",o.type="any-one",this._vendorData.any_one_approvers.forEach(r=>{let a={_id:r._id,user:r.full_name,approval_action:"--",workflow_status:e,access:t};if(this._workflowData.length>0){var i=this.verifyApproverAction("any-one",r._id);i.length>0&&(t=!t,a.approval_action=i[0].approval_action,a.workflow_status=i[0].workflow_status)}o.approvers.push(a)}),o.approvers.forEach(e=>{e.access=t})}if(this.statusLog.push(o),"round-robin"===o.type){let t=this.statusLog[this.statusLog.length-1].approvers[this.statusLog[this.statusLog.length-1].approvers.length-1];"Approve"===t.approval_action?this.statusLog[this.statusLog.length-1].approvers.every(t=>"Approve"===t.approval_action)&&(this._finalResult="Final Result: This workflow was executed successfully.",this.updateStatus()):"Reject"===t.approval_action?(this._finalResult="Final Result: This workflow was terminated.",this.updateStatus()):"Reject & Remove from workflow"===t.approval_action&&this.prepareLog(t.approval_action,t.workflow_status)}else"any-one"===o.type&&this.statusLog[this.statusLog.length-1].approvers.some(t=>"Approve"===t.approval_action)&&this.prepareLog("Approve","Active")}}verifyApproverAction(t,e){return this._workflowData.filter(o=>o.user_id===e&&o.type_of_approval===t)}updateLog(t,e){this._workflowProvider.submitWorklog({vendor_id:this.vendor_id,user_id:this._currUser,type_of_approval:e,approval_action:t.target.value,workflow_status:"Reject"===t.target.value?"Terminated":"Active"}).subscribe(t=>{t.error||this.fetchWorkflow()})}updateStatus(){""===this._vendorData.workflow_status&&this._vendorProvider.updateVendor(this._vendorData._id,{workflow_status:this._finalResult}).subscribe(t=>{t.error||this._alert.success(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(s.c9),n.Y36(s.e8),n.Y36(s.mq),n.Y36(a.gz),n.Y36(s.zy))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-vendor-workflow"]],decls:18,vars:3,consts:[["header","",1,"card-header"],[4,"ngIf"],["body","",1,"card-body"],[1,"row"],[1,"col-md-4","col-sm-12","col-no-padding"],["class","info-container",4,"ngIf"],[1,"col-md-8","col-sm-12","col-no-padding","col-divider"],[1,"data-container"],[1,"col-sm-12","col-no-padding"],[1,"section-wrapper"],[1,"section-heading"],["type","button",1,"btn-datatable-2",3,"click"],[1,"mdi","mdi-reload","mdi-18px"],["class","col-sm-12 col-no-padding",4,"ngIf"],[1,"info-container"],[1,"task-wrap-container"],[1,"section-heading","mb-4"],[1,"keywords-container"],[1,"label"],[1,"main-menu"],["ngFor","",3,"ngForOf"],[3,"ngIf"],[1,"table","mb-8"],[1,"thead-dark"],["scope","col"],[1,"form-control","custom-select",3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(n.TgZ(0,"app-ui-card"),n.TgZ(1,"div",0),n.YNc(2,y,2,1,"h3",1),n.qZA(),n.TgZ(3,"div",2),n.TgZ(4,"div",3),n.TgZ(5,"div",4),n.YNc(6,U,26,8,"div",5),n.qZA(),n.TgZ(7,"div",6),n.TgZ(8,"div",7),n.TgZ(9,"div",3),n.TgZ(10,"div",8),n.TgZ(11,"div",9),n.TgZ(12,"p",10),n._uU(13,"Workflow Status"),n.qZA(),n.TgZ(14,"button",11),n.NdJ("click",function(){return e.fetchWorkflow()}),n._UZ(15,"i",12),n._uU(16," Reload Workflow"),n.qZA(),n.qZA(),n.qZA(),n.YNc(17,D,3,2,"div",13),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&t&&(n.xp6(2),n.Q6J("ngIf",e._vendorData),n.xp6(4),n.Q6J("ngIf",e._vendorData),n.xp6(11),n.Q6J("ngIf",e._showWorkflow))},directives:[p.A,d.O5,d.sg,h.YN,h.Kr],pipes:[d.uU],styles:[".btn-datatable-2[_ngcontent-%COMP%]{right:0;top:-5px;position:absolute}.table[_ngcontent-%COMP%]   .thead-dark[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{width:33%}"]}),t})(),data:{title:"Vendor Workflow"}},{path:"create-vendor",component:T,data:{title:"Create Vendor"}}]}];let E=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[[a.Bz.forChild(V)],a.Bz]}),t})(),P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.oAB({type:t}),t.\u0275inj=n.cJS({imports:[[r.O,E]]}),t})()}}]);